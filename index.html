<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Click to Continue</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
        background-color: #ffffff;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
        overflow-x: hidden;
      }

      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        max-width: 500px;
        width: 100%;
      }

      h1 {
        font-size: clamp(28px, 8vw, 42px);
        font-weight: 800;
        color: #000000;
        margin-bottom: 30px;
        letter-spacing: -0.5px;
        line-height: 1.2;
        text-align: center;
      }

      .arrows {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 25px;
        animation: bounce 2s infinite;
      }

      .arrow {
        width: 0;
        height: 0;
        border-left: 20px solid transparent;
        border-right: 20px solid transparent;
        border-top: 25px solid #000000;
        margin-bottom: -10px;
        opacity: 0.8;
      }

      .arrow:nth-child(2) {
        opacity: 0.5;
      }

      .arrow:nth-child(3) {
        opacity: 0.3;
        margin-bottom: 0;
      }

      @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-10px);
        }
        60% {
          transform: translateY(-5px);
        }
      }

      .cta-button {
        background: linear-gradient(180deg, #4A90E2 0%, #357ABD 100%);
        color: #ffffff;
        font-size: 18px;
        font-weight: 700;
        letter-spacing: 0.5px;
        padding: 18px 60px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        text-transform: uppercase;
        box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
        transition: all 0.3s ease;
        min-width: 250px;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }

      .cta-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);
      }

      .cta-button:active {
        transform: translateY(0);
        box-shadow: 0 2px 10px rgba(74, 144, 226, 0.3);
      }

      .cta-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      @media (max-width: 480px) {
        .cta-button {
          font-size: 16px;
          padding: 16px 50px;
          min-width: 220px;
        }

        h1 {
          margin-bottom: 25px;
        }

        .arrows {
          margin-bottom: 20px;
        }
      }

      @media (max-width: 360px) {
        .cta-button {
          padding: 15px 40px;
          min-width: 200px;
        }
      }
    </style>
</head>
<body>
    <div class="container">
      <h1>Click Here To Continue</h1>

      <div class="arrows">
        <div class="arrow"></div>
        <div class="arrow"></div>
        <div class="arrow"></div>
      </div>

      <button class="cta-button" onclick="handleContinue()">CONTINUE</button>
    </div>

    <script>
      let redirectAttempted = false;

      const isAndroid = () => {
        return /Android/i.test(navigator.userAgent);
      };

      const formatDeepLink = (url, osType) => {
        try {
          const urlObj = new URL(url);
          const hostname = urlObj.hostname;
          const pathAndParams = urlObj.pathname + urlObj.search + urlObj.hash;

          if (osType === "a") {
            // Improved Android intent with package and fallback
            const intentScheme = "intent://";
            const intentEnd = "#Intent;scheme=https;package=com.android.chrome;S.browser_fallback_url=" + 
                            encodeURIComponent(url) + ";end;";
            return intentScheme + hostname + pathAndParams + intentEnd;
          } else {
            const safariPrefix = "x-safari-https://";
            return url
              .replace(/^https:\/\//, safariPrefix)
              .replace(/^http:\/\//, safariPrefix.replace("s", ""));
          }
        } catch (e) {
          console.error('Deep link formatting error:', e);
          return url;
        }
      };

      function attemptRedirect(url, isDeepLink = false) {
        if (redirectAttempted) return;
        
        try {
          window.location.href = url;
          redirectAttempted = true;
          
          // If this is a deep link attempt, set up fallback
          if (isDeepLink) {
            // If we're still here after 1.5 seconds, the deep link failed
            setTimeout(() => {
              if (!document.hidden) {
                // Page is still visible, deep link didn't work
                // Try regular HTTPS redirect
                const regularUrl = url.replace(/^intent:\/\//, 'https://')
                                      .replace(/#Intent.*$/, '')
                                      .replace(/^x-safari-https:\/\//, 'https://');
                window.location.href = regularUrl;
              }
            }, 1500);
          }
        } catch (e) {
          console.error('Redirect error:', e);
          // Fallback to regular URL on error
          if (isDeepLink) {
            const regularUrl = url.replace(/^intent:\/\//, 'https://')
                                  .replace(/#Intent.*$/, '')
                                  .replace(/^x-safari-https:\/\//, 'https://');
            window.location.href = regularUrl;
          }
        }
      }

      function handleContinue() {
        // Prevent double-clicks
        if (redirectAttempted) return;
        
        // Disable button
        const button = event.target;
        button.disabled = true;

        // Get all URL parameters from the current page
        const urlParams = new URLSearchParams(window.location.search);
        
        // Your button's base URL
        const baseButtonUrl = 'https://frostedwinter.com/?utm_source=subid';
        
        // Parse the base URL to get its existing parameters
        const buttonUrlObj = new URL(baseButtonUrl);
        
        // Add/override with all parameters from the current page URL
        urlParams.forEach((value, key) => {
          buttonUrlObj.searchParams.set(key, value);
        });
        
        // Get the final URL
        const finalRedirectUrl = buttonUrlObj.toString();

        // Small delay to ensure click registers on mobile
        setTimeout(() => {
          // Format as deep link for mobile
          let finalBreakoutUrl = finalRedirectUrl;

          if (isAndroid()) {
            finalBreakoutUrl = formatDeepLink(finalRedirectUrl, "a");
            attemptRedirect(finalBreakoutUrl, true);
          } else {
            finalBreakoutUrl = formatDeepLink(finalRedirectUrl, "i");
            attemptRedirect(finalBreakoutUrl, true);
          }
        }, 100);
      }

      // Detect if user returns to page (deep link failed)
      document.addEventListener('visibilitychange', () => {
        if (!document.hidden && redirectAttempted) {
          // User came back, try regular redirect as final fallback
          const urlParams = new URLSearchParams(window.location.search);
          const baseButtonUrl = 'https://frostedwinter.com/?utm_source=subid';
          const buttonUrlObj = new URL(baseButtonUrl);
          urlParams.forEach((value, key) => {
            buttonUrlObj.searchParams.set(key, value);
          });
          window.location.href = buttonUrlObj.toString();
        }
      });
    </script>
</body>
</html>
